<!DOCTYPE html>
<!--Este ejercicio consiste en aprender a validar formularios con criterior propios-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <form action="#" method="post" id="miFormulario">
        <h1>Mi primer formulario Javascript</h1>
        <table>
            <tr>
                <td><label for="fecha">Fecha</label></td>
                <td><input  id="fecha" type="text"></td>
                <td><span id="spanfecha"></span></td>
            </tr>
            <tr>
                <td><label for="cocinero">Cocinero</label></td>
                <td><input  id="cocinero" type="text"></td>
                <td><span id="spancocinero"></span></td>
            </tr>
            <tr>
                <td><label for="destinatario">Destinatario</label></td>
                <td><input  id="destinatario" type="text"></td>
                <td><span id="spandestinatario"></span></td>
            </tr>
            <tr>
                <td><label for="gramos">Gramos</label></td>
                <td><input  id="gramos" type="text"></td>
                <td><span id="spangramos"></span></td>
            </tr>
            <tr>
                <td><label for="composicion">Composicion</label></td>
                <td><input  id="composicion" type="text"></td>
                <td><span id="spancomposicion"></span></td>
            </tr>
            <tr>
                <td><label for="cuenta">Cuenta</label></td>
                <td><input  id="cuenta" type="text"></td>
                <td><span id="spancuenta"></span></td>
            </tr>
            <tr>
                <td><input id="enviar" type="submit"><span id="spanenviar" hidden></span></td>
            </tr>

        </table>
    </form>
    <script>
         //funcion que valida el formulario
         function validarformulario(event) {
                event.preventDefault();
               /*Traemos todos los elemtnos del formulario, este validador funciona con cualqueir formulario, 
               siempre y cuando TODOS los imput se correspondan con un span que tenga de id="span"+ la id del input*/
                let elementos = document.getElementById("miFormulario").elements;
                /*El metodo anterior nos devuelve una coleccion por lo que lo parseamos a un array 
                para poder trabajar con el como dicho objeto*/
                let elementosArray = Array.from(elementos);

                //console.log(elementosArray);//linea de depuracion
                /*el array contiene en cada posicion un elemento html del formulario, solo los elementos input tienen
                reglas de validacion, por lo que aunque los recorra todos, solo va a reaccionar a los elementos que tengan
                reglas de validacion y que estas no se cumplan, por ello, vamos revisando elemento por elemento*/
                elementosArray.forEach(element => {

                    //console.log(element);//linea de depuracino
                        //construimos el la id del span para poder acceder a el
                        let spanId = 'span' + element.id;

                        //console.log(spanId);//linea de depuracion
                        //traemos el span que ya hemos identificado
                        let spanElement = document.getElementById(`${spanId}`);
                        
                        //console.log(spanElement);//linea de depuracion
                        //nos aseguramos de que no contenga ningun valor
                        spanElement.innerHTML = '';

                        //console.log(element.checkValidity());//linea de depuracion
                    //pasamos el validador..... si el elemento que tenemos en esta iteracion NO es valido....
                    
                    switch (element.id) {
                    case "fecha":
                        let fecha=/^\d{2}\/\d{2}\/\d{4}\s\d{2}:\d{2}$/;
                        if(!fecha.test(element.value)){
                            spanElement.innerHTML = '❌';
                        }else{
                            spanElement.innerHTML = '✅';
                        };
                        break;
                    case "cocinero":
                        let cocinero=/^[A-Z]{2}\W{1}[0-9]{4}$/;
                        if(!cocinero.test(element.value)){
                            spanElement.innerHTML="❌";
                        }else{
                            spanElement.innerHTML = '✅';
                        }
                        break;
                    case "destinatario":
                        let destinatario=/^[A-Z]{2,3}\_[a-z]\:[0-9]{4}$/;
                        if(!destinatario.test(element.value)){
                            spanElement.innerHTML = '❌';
                        }else{
                            spanElement.innerHTML = '✅';
                        };
                        break;
                    case "gramos":
                        if(!(parseInt(element.value)>=1000 && parseInt(element.value)<=5000)){
                            spanElement.innerHTML = '❌';
                        }else{
                            spanElement.innerHTML = '✅';
                        };
                        break;
                    case "composicion":
                        let composicion=/^[A-Z]&&[^ñÑllLL][A-Z]{2}[0-9]{1}[A-Z]{2}$/;
                        if(!composicion.test(element.value)){
                            spanElement.innerHTML = '❌';
                        }else{
                            spanElement.innerHTML = '✅';
                        };
                        break;
                        
                    case "cuenta":
                        let cuenta=element.value;
                        let dosLetras=cuenta.substring(0-2);
                        let dosDigitos=cuenta.substring(2-4);
                        let guion=cuenta[4];
                        let doceDigitos=cuenta.substring(5-17);
                        let guion2=cuenta[17];
                        let control=cuenta.substring(18,20);

                        let cuentaDefinitiva;
                        let valido=true;

                        break;
                   
                    default:
                        break;
                   };

                });
            };
                
        
        
        /*evento contenedor del resto de escuchadores, que sive para que el resto escuchen
        siemore y cuando la pagina esté cargada, es una forma de evitar errores al ejecutar acciones
        sobre elementos, que puedieran no estar cargados*/

        window.addEventListener("load", function(){
            //evento que valida el formulario para personalizar los errores
            document.getElementById("enviar").addEventListener("click", validarformulario);
            });
    </script>
</body>
</html>